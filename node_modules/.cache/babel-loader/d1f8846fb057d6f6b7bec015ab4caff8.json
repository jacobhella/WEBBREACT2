{"ast":null,"code":"'use strict';\n\nvar licenses = [].concat(require('spdx-license-ids')).concat(require('spdx-license-ids/deprecated'));\nvar exceptions = require('spdx-exceptions');\nmodule.exports = function (source) {\n  var index = 0;\n  function hasMore() {\n    return index < source.length;\n  }\n\n  // `value` can be a regexp or a string.\n  // If it is recognized, the matching source string is returned and\n  // the index is incremented. Otherwise `undefined` is returned.\n  function read(value) {\n    if (value instanceof RegExp) {\n      var chars = source.slice(index);\n      var match = chars.match(value);\n      if (match) {\n        index += match[0].length;\n        return match[0];\n      }\n    } else {\n      if (source.indexOf(value, index) === index) {\n        index += value.length;\n        return value;\n      }\n    }\n  }\n  function skipWhitespace() {\n    read(/[ ]*/);\n  }\n  function operator() {\n    var string;\n    var possibilities = ['WITH', 'AND', 'OR', '(', ')', ':', '+'];\n    for (var i = 0; i < possibilities.length; i++) {\n      string = read(possibilities[i]);\n      if (string) {\n        break;\n      }\n    }\n    if (string === '+' && index > 1 && source[index - 2] === ' ') {\n      throw new Error('Space before `+`');\n    }\n    return string && {\n      type: 'OPERATOR',\n      string: string\n    };\n  }\n  function idstring() {\n    return read(/[A-Za-z0-9-.]+/);\n  }\n  function expectIdstring() {\n    var string = idstring();\n    if (!string) {\n      throw new Error('Expected idstring at offset ' + index);\n    }\n    return string;\n  }\n  function documentRef() {\n    if (read('DocumentRef-')) {\n      var string = expectIdstring();\n      return {\n        type: 'DOCUMENTREF',\n        string: string\n      };\n    }\n  }\n  function licenseRef() {\n    if (read('LicenseRef-')) {\n      var string = expectIdstring();\n      return {\n        type: 'LICENSEREF',\n        string: string\n      };\n    }\n  }\n  function identifier() {\n    var begin = index;\n    var string = idstring();\n    if (licenses.indexOf(string) !== -1) {\n      return {\n        type: 'LICENSE',\n        string: string\n      };\n    } else if (exceptions.indexOf(string) !== -1) {\n      return {\n        type: 'EXCEPTION',\n        string: string\n      };\n    }\n    index = begin;\n  }\n\n  // Tries to read the next token. Returns `undefined` if no token is\n  // recognized.\n  function parseToken() {\n    // Ordering matters\n    return operator() || documentRef() || licenseRef() || identifier();\n  }\n  var tokens = [];\n  while (hasMore()) {\n    skipWhitespace();\n    if (!hasMore()) {\n      break;\n    }\n    var token = parseToken();\n    if (!token) {\n      throw new Error('Unexpected `' + source[index] + '` at offset ' + index);\n    }\n    tokens.push(token);\n  }\n  return tokens;\n};","map":null,"metadata":{},"sourceType":"script"}