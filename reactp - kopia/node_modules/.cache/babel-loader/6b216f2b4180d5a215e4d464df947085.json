{"ast":null,"code":"/*\n Copyright 2012-2015, Yahoo Inc.\n Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.\n */\nvar util = require('util'),\n  path = require('path'),\n  fs = require('fs'),\n  mkdirp = require('mkdirp'),\n  supportsColor = require('supports-color'),\n  isAbsolute = path.isAbsolute || /* istanbul ignore next */function (p) {\n    return path.resolve(p) === path.normalize(p);\n  };\n\n/**\n * abstract interface for writing content\n * @class ContentWriter\n * @constructor\n */\n/* istanbul ignore next: abstract class */\nfunction ContentWriter() {}\n\n/**\n * writes a string as-is to the destination\n * @param {String} str the string to write\n */\n/* istanbul ignore next: abstract class */\nContentWriter.prototype.write = function () {\n  throw new Error('write: must be overridden');\n};\n\n/**\n * returns the colorized version of a string. Typically,\n * content writers that write to files will return the\n * same string and ones writing to a tty will wrap it in\n * appropriate escape sequences.\n * @param {String} str the string to colorize\n * @param {String} clazz one of `high`, `medium` or `low`\n * @returns {String} the colorized form of the string\n */\nContentWriter.prototype.colorize = function (str /*, clazz*/) {\n  return str;\n};\n\n/**\n * writes a string appended with a newline to the destination\n * @param {String} str the string to write\n */\nContentWriter.prototype.println = function (str) {\n  this.write(str + '\\n');\n};\n\n/**\n * closes this content writer. Should be called after all writes are complete.\n */\nContentWriter.prototype.close = function () {};\n\n/**\n * a content writer that writes to a file\n * @param {Number} fd - the file descriptor\n * @extends ContentWriter\n * @constructor\n */\nfunction FileContentWriter(fd) {\n  this.fd = fd;\n}\nutil.inherits(FileContentWriter, ContentWriter);\nFileContentWriter.prototype.write = function (str) {\n  fs.writeSync(this.fd, str);\n};\nFileContentWriter.prototype.close = function () {\n  fs.closeSync(this.fd);\n};\n\n/**\n * a content writer that writes to the console\n * @extends ContentWriter\n * @constructor\n */\nfunction ConsoleWriter() {}\nutil.inherits(ConsoleWriter, ContentWriter);\n\n// allow stdout to be captured for tests.\nvar capture = false;\nvar output = '';\nConsoleWriter.prototype.write = function (str) {\n  if (capture) {\n    output += str;\n  } else {\n    process.stdout.write(str);\n  }\n};\nConsoleWriter.prototype.colorize = function (str, clazz) {\n  var colors = {\n    low: '31;1',\n    medium: '33;1',\n    high: '32;1'\n  };\n\n  /* istanbul ignore next: different modes for CI and local */\n  if (supportsColor && colors[clazz]) {\n    return \"\\x1B[\" + colors[clazz] + 'm' + str + \"\\x1B[0m\";\n  }\n  return str;\n};\n\n/**\n * utility for writing files under a specific directory\n * @class FileWriter\n * @param {String} baseDir the base directory under which files should be written\n * @constructor\n */\nfunction FileWriter(baseDir) {\n  if (!baseDir) {\n    throw new Error('baseDir must be specified');\n  }\n  this.baseDir = baseDir;\n}\n\n/**\n* static helpers for capturing stdout report output;\n* super useful for tests!\n*/\nFileWriter.startCapture = function () {\n  capture = true;\n};\nFileWriter.stopCapture = function () {\n  capture = false;\n};\nFileWriter.getOutput = function () {\n  return output;\n};\nFileWriter.resetOutput = function () {\n  output = '';\n};\n\n/**\n * returns a FileWriter that is rooted at the supplied subdirectory\n * @param {String} subdir the subdirectory under which to root the\n *  returned FileWriter\n * @returns {FileWriter}\n */\nFileWriter.prototype.writerForDir = function (subdir) {\n  if (isAbsolute(subdir)) {\n    throw new Error('Cannot create subdir writer for absolute path: ' + subdir);\n  }\n  return new FileWriter(this.baseDir + '/' + subdir);\n};\n/**\n * copies a file from a source directory to a destination name\n * @param {String} source path to source file\n * @param {String} dest relative path to destination file\n */\nFileWriter.prototype.copyFile = function (source, dest) {\n  if (isAbsolute(dest)) {\n    throw new Error('Cannot write to absolute path: ' + dest);\n  }\n  dest = path.resolve(this.baseDir, dest);\n  mkdirp.sync(path.dirname(dest));\n  fs.writeFileSync(dest, fs.readFileSync(source));\n};\n/**\n * returns a content writer for writing content to the supplied file.\n * @param {String|null} file the relative path to the file or the special\n *  values `\"-\"` or `null` for writing to the console\n * @returns {ContentWriter}\n */\nFileWriter.prototype.writeFile = function (file) {\n  if (file === null || file === '-') {\n    return new ConsoleWriter();\n  }\n  if (isAbsolute(file)) {\n    throw new Error('Cannot write to absolute path: ' + file);\n  }\n  file = path.resolve(this.baseDir, file);\n  mkdirp.sync(path.dirname(file));\n  return new FileContentWriter(fs.openSync(file, 'w'));\n};\nmodule.exports = FileWriter;","map":null,"metadata":{},"sourceType":"script"}