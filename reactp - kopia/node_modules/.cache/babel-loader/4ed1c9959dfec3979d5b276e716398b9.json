{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\nvar _inherits3 = _interopRequireDefault(_inherits2);\nvar _optionManager = require(\"./file/options/option-manager\");\nvar _optionManager2 = _interopRequireDefault(_optionManager);\nvar _babelMessages = require(\"babel-messages\");\nvar messages = _interopRequireWildcard(_babelMessages);\nvar _store = require(\"../store\");\nvar _store2 = _interopRequireDefault(_store);\nvar _babelTraverse = require(\"babel-traverse\");\nvar _babelTraverse2 = _interopRequireDefault(_babelTraverse);\nvar _assign = require(\"lodash/assign\");\nvar _assign2 = _interopRequireDefault(_assign);\nvar _clone = require(\"lodash/clone\");\nvar _clone2 = _interopRequireDefault(_clone);\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n    newObj.default = obj;\n    return newObj;\n  }\n}\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nvar GLOBAL_VISITOR_PROPS = [\"enter\", \"exit\"];\nvar Plugin = function (_Store) {\n  (0, _inherits3.default)(Plugin, _Store);\n  function Plugin(plugin, key) {\n    (0, _classCallCheck3.default)(this, Plugin);\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Store.call(this));\n    _this.initialized = false;\n    _this.raw = (0, _assign2.default)({}, plugin);\n    _this.key = _this.take(\"name\") || key;\n    _this.manipulateOptions = _this.take(\"manipulateOptions\");\n    _this.post = _this.take(\"post\");\n    _this.pre = _this.take(\"pre\");\n    _this.visitor = _this.normaliseVisitor((0, _clone2.default)(_this.take(\"visitor\")) || {});\n    return _this;\n  }\n  Plugin.prototype.take = function take(key) {\n    var val = this.raw[key];\n    delete this.raw[key];\n    return val;\n  };\n  Plugin.prototype.chain = function chain(target, key) {\n    if (!target[key]) return this[key];\n    if (!this[key]) return target[key];\n    var fns = [target[key], this[key]];\n    return function () {\n      var val = void 0;\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      for (var _iterator = fns, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n        var _ref;\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref = _i.value;\n        }\n        var fn = _ref;\n        if (fn) {\n          var ret = fn.apply(this, args);\n          if (ret != null) val = ret;\n        }\n      }\n      return val;\n    };\n  };\n  Plugin.prototype.maybeInherit = function maybeInherit(loc) {\n    var inherits = this.take(\"inherits\");\n    if (!inherits) return;\n    inherits = _optionManager2.default.normalisePlugin(inherits, loc, \"inherits\");\n    this.manipulateOptions = this.chain(inherits, \"manipulateOptions\");\n    this.post = this.chain(inherits, \"post\");\n    this.pre = this.chain(inherits, \"pre\");\n    this.visitor = _babelTraverse2.default.visitors.merge([inherits.visitor, this.visitor]);\n  };\n  Plugin.prototype.init = function init(loc, i) {\n    if (this.initialized) return;\n    this.initialized = true;\n    this.maybeInherit(loc);\n    for (var key in this.raw) {\n      throw new Error(messages.get(\"pluginInvalidProperty\", loc, i, key));\n    }\n  };\n  Plugin.prototype.normaliseVisitor = function normaliseVisitor(visitor) {\n    for (var _iterator2 = GLOBAL_VISITOR_PROPS, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : (0, _getIterator3.default)(_iterator2);;) {\n      var _ref2;\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n      var key = _ref2;\n      if (visitor[key]) {\n        throw new Error(\"Plugins aren't allowed to specify catch-all enter/exit handlers. \" + \"Please target individual nodes.\");\n      }\n    }\n    _babelTraverse2.default.explode(visitor);\n    return visitor;\n  };\n  return Plugin;\n}(_store2.default);\nexports.default = Plugin;\nmodule.exports = exports[\"default\"];","map":null,"metadata":{},"sourceType":"script"}